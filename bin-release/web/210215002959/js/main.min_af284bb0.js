var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{h(s.next(e))}catch(t){r(t)}}function a(e){try{h(s["throw"](e))}catch(t){r(t)}}function h(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,a)}h((s=s.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),[3,5];case 4:return t=i.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var s=new eui.Theme("resource/default.thm.json",e.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.addPage("Home"),Toast.init(this),this.socketsListening()},t.prototype.socketsListening=function(){var e=this;socket.on("CreateRoomSuccess",function(e){console.log("Server:CreateRoomSuccess");var t={username:"",token:"",roomID:""};t.username=username,t.token=token,t.roomID=e.roomID,socket.emit("EnterRoomAfterCreate",t),console.log("emit EnterRoomAfterCreate")}),socket.on("EnterRoomSuccess",function(t){console.log("Server:EnterRoomSuccess"),e.openRoom(t)}),socket.on("EnterGameSuccess",function(t){console.log("Server:EnterGameSuccess"),e.openRoom(t);var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="EnterGameSuccess",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("GotNotation",function(t){console.log("Server:GotNotation"),e.openRoom(t);var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="GotNotation",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("EnterRoomAfterCreateSuccess",function(t){console.log("Server:EnterRoomSuccessAfterCreateSuccess"),e.openRoom(t)}),socket.on("PlayersChanges",function(t){console.log("Server:PlayersChanges");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="PlayersChanges",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("LeaveRoomSuccess",function(t){console.log("Server:LeaveRoomSuccess");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="LeaveRoomSuccess",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("RoomDismissed",function(t){console.log("Server:RoomDismissed");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="RoomDismissed",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("BeKicked",function(t){console.log("Server:BeKicked");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="BeKicked",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("GameStarted",function(t){console.log("Server:GameStarted");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="GameStarted",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("GameOver",function(t){console.log("Server:GameOver");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="GameOver",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("NewNotation",function(t){console.log("Server:NewNotation");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="NewNotation",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)}),socket.on("OfferingDraw",function(t){console.log("Server:OfferingDraw");var i=new LOBBYEVENT(LOBBYEVENT.SOCKETMSG);i.socketevent="OfferingDraw",i.roomData=t,e._Room&&e._Room.dispatchEvent(i)})},t.prototype.openRoom=function(e){var t=this;this._Room||(this._Room=new Room,this._Room.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName)},this)),this._Room.init(e),this.addChild(this._Room),this._Home&&(this._Home.visible=!1)},t.prototype.addPage=function(e){var t=this;switch(e){case"Home":this._Home||(this._Home=new Home,this._Home.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName)},this)),this.addChild(this._Home),this._Home&&(this._Home.visible=!0);break;case"Login":this._Login||(this._Login=new Login,this._Login.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName)},this),this._Login.addEventListener(LOBBYEVENT.LOGIN,function(){isLogin=!0,Toast.launch("欢迎！"+username),t._Home.person.text="hi,"+username;var e={username:"",token:""};e.username=username,e.token=token,socket.emit("UserLogin",e)},this)),this.addChild(this._Login);break;case"Person":this._Person||(this._Person=new Person,this._Person.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName)},this),this._Person.addEventListener(LOBBYEVENT.LOGOUT,function(){Toast.launch("再见, "+username),t._Home.person.text="请登录";var e={username:""};e.username=username,socket.emit("UserLogout",e),isLogin=!1,username="guest"},this)),this.addChild(this._Person);break;case"Create":this._Create||(this._Create=new Create,this._Create.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName)},this),this._Create.addEventListener(LOBBYEVENT.ENTERROOM,function(e){t.openRoom(e.roomData)},this)),this.addChild(this._Create);break;case"ChangePW":this._ChangePW||(this._ChangePW=new ChangePW,this._ChangePW.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName),"Login"==e.pageName&&(t._Login.userName.text=e.username,Toast.launch("修改成功！请用新密码登录！"))},this),this._ChangePW.addEventListener(LOBBYEVENT.LOGOUT,function(){isLogin=!1,t._Home.person.text="请登录"},this)),this.addChild(this._ChangePW);break;case"FindPW":this._FindPW||(this._FindPW=new FindPW,this._FindPW.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName),"Login"==e.pageName&&(t._Login.userName.text=e.username,Toast.launch("请用新密码登录！"))},this)),this.addChild(this._FindPW);break;case"Register":this._Register||(this._Register=new Register,this._Register.addEventListener(LOBBYEVENT.OPEN,function(e){t.addPage(e.pageName),"Login"==e.pageName&&(t._Login.userName.text=e.username,Toast.launch("注册成功请登录！"))},this)),this.addChild(this._Register);break;case"Room":var i={roomID:"r1",hostName:"ruchaos",gameName:"ruchaos ‘s game",roomState:2,gameType:1,gameTime:1,players:[{playerName:"ruchaos",playerTimeA:60,playerTimeB:600},{playerName:"lynn",playerTimeA:60,playerTimeB:600},{playerName:"ruchaos",playerTimeA:60,playerTimeB:600},{playerName:"lynn",playerTimeA:60,playerTimeB:600}],gameVersion:"CC1.0",gameID:123456,gameMenu:["aE-Bc","fSxAbxBb"],gameBoards:["","ASDFBSDSDA+eE-Bc","SDFASDFASDF+ fSxAbxBb"],gameDate:1604398926,gameresult:{winnerteam:0,winner:[],loser:[],drawer:[]}};this.openRoom(i)}},t}(eui.UILayer);__reflect(Main.prototype,"Main");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?s(n):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ChangePW=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/ChangePW.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners()},t.prototype.addListeners=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.curtain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.curtainHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.password.addEventListener(egret.FocusEvent.FOCUS_OUT,this.passwordCheck,this),this.repeatPW.addEventListener(egret.FocusEvent.FOCUS_OUT,this.repeatPWCheck,this),this.clueName.addEventListener(egret.FocusEvent.FOCUS_OUT,this.clueNameCheck,this)},t.prototype.curtainHandler=function(){this.closePanel()},t.prototype.btnCloseHandler=function(){this.closePanel()},t.prototype.passwordCheck=function(){var e=new RegExp("^[!-~]{6,18}$");return e.test(this.password.text)?(this.lhintPW.visible=!1,!0):(this.lhintPW.text=" 密码格式错误 6-18位，英文、数字、符号 ",this.lhintPW.visible=!0,!1)},t.prototype.repeatPWCheck=function(){return this.repeatPW.text!=this.password.text?(this.lhintRP.text=" 请重复密码 ",this.lhintRP.visible=!0,!1):(this.lhintRP.visible=!1,!0)},t.prototype.clueNameCheck=function(){var e=new RegExp("^[一-龥!-~]{1,18}$");return e.test(this.clueName.text)?(this.lhintCN.visible=!1,!0):(this.lhintCN.text=" 不能使用空格或为空 ",this.lhintCN.visible=!0,!1)},t.prototype.btnSubmitHandler=function(){var e=!1;if(this.passwordCheck()&&this.repeatPWCheck()&&this.clueNameCheck()&&(e=!0),e){var t={type:"changePW",username:"",password:"",cluename:""};t.username=username,t.password=this.password.text,t.cluename=this.clueName.text,this.httppost(ChangePWSrv,t)}},t.prototype.changePWSuccess=function(e){console.log(e+" 修改成功！");var t=new LOBBYEVENT(LOBBYEVENT.LOGOUT);this.dispatchEvent(t);var i=new LOBBYEVENT(LOBBYEVENT.OPEN);i.pageName="Login",i.username=e,this.dispatchEvent(i),this.closePanel()},t.prototype.changePWFailed=function(e){e.password&&(this.lhintPW.text=e.password,this.lhintPW.visible=!0),e.cluename&&(this.lhintCN.text=e.cluename,this.lhintCN.visible=!0),Toast.launch("修改失败 "+e.msg)},t.prototype.httppost=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json");var s=JSON.stringify(t);i.send(s),i.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),i.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget,i=JSON.parse(t.response);if(i.type)switch(i.type){case"changePW":this.changePWSuccess(i.username);break;case"error":this.changePWFailed(i.error)}},t.prototype.onPostIOError=function(e){Toast.launch("IOError"),console.log("post error : "+e)},t.prototype.onPostProgress=function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},t.prototype.closePanel=function(){this.password.text="",this.repeatPW.text="",this.clueName.text="",this.lhintPW.visible=!1,this.lhintRP.visible=!1,this.lhintCN.visible=!1,this.parent.removeChild(this)},t}(eui.Component);__reflect(ChangePW.prototype,"ChangePW",["eui.UIComponent","egret.DisplayObject"]);var Create=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Create.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners(),this.init()},t.prototype.init=function(){this.hostName=username,this.title.text=this.hostName+" 's game",this.type4Handler(),this.time1Handler()},t.prototype.addListeners=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.curtain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.curtainHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.type1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.type1Handler,this),this.type2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.type2Handler,this),this.type4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.type4Handler,this),this.time1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.time1Handler,this),this.time2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.time2Handler,this),this.time3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.time3Handler,this)},t.prototype.curtainHandler=function(){this.closePanel()},t.prototype.btnCloseHandler=function(){this.closePanel()},t.prototype.btnSubmitHandler=function(){var e={username:"",token:"",gameName:"",gameType:1,gameTime:1};e.username=username,e.token=token,e.gameName=username+" 's game",e.gameType=this.gameType,e.gameTime=this.gameTime;socket.emit("CreateRoom",e),this.closePanel()},t.prototype.type1Handler=function(){this.setBtnTypeFocus(this.type1),this.gameType=1,this.typehint.text="每人控制两方棋子，房主决定先后手"},t.prototype.type2Handler=function(){this.setBtnTypeFocus(this.type2),this.gameType=2,this.typehint.text="每人各控制一方棋子"},t.prototype.type4Handler=function(){this.setBtnTypeFocus(this.type4),this.gameType=4,this.typehint.text="每人控制两方棋子，随机先后手"},t.prototype.time1Handler=function(){this.setBtnTimeFocus(this.time1),this.gameTime=1,this.timehint.text="每步1分钟，步超时消耗长考时间，长考时间每人10分钟"},t.prototype.time2Handler=function(){this.setBtnTimeFocus(this.time2),this.gameTime=2,this.timehint.text="每人45分钟包干，单步不限时长，包干时间用尽1分钟读秒"},t.prototype.time3Handler=function(){this.setBtnTimeFocus(this.time3),this.gameTime=3,this.timehint.text="不限步时长（游戏最多保留24小时）"},t.prototype.closePanel=function(){this.parent.removeChild(this)},t.prototype.setBtnTypeFocus=function(e){this.type1.selected=!1,this.type2.selected=!1,this.type4.selected=!1,e.selected=!0},t.prototype.setBtnTimeFocus=function(e){this.time1.selected=!1,this.time2.selected=!1,this.time3.selected=!1,e.selected=!0},t}(eui.Component);__reflect(Create.prototype,"Create",["eui.UIComponent","egret.DisplayObject"]);var FindPW=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/FindPW.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners()},t.prototype.addListeners=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.curtain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.curtainHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.userName.addEventListener(egret.FocusEvent.FOCUS_OUT,this.userNameCheck,this),this.password.addEventListener(egret.FocusEvent.FOCUS_OUT,this.passwordCheck,this),this.repeatPW.addEventListener(egret.FocusEvent.FOCUS_OUT,this.repeatPWCheck,this),this.clueName.addEventListener(egret.FocusEvent.FOCUS_OUT,this.clueNameCheck,this)},t.prototype.curtainHandler=function(){this.closePanel()},t.prototype.btnCloseHandler=function(){this.closePanel()},t.prototype.userNameCheck=function(){var e=new RegExp("^[A-Za-z0-9]{4,10}$");return e.test(this.userName.text)?(this.lhintUN.visible=!1,!0):(this.lhintUN.text=" 用户名格式错误 ",this.lhintUN.visible=!0,!1)},t.prototype.passwordCheck=function(){var e=new RegExp("^[!-~]{6,18}$");return e.test(this.password.text)?(this.lhintPW.visible=!1,!0):(this.lhintPW.text=" 密码格式错误 6-18位，英文、数字、符号 ",this.lhintPW.visible=!0,!1)},t.prototype.repeatPWCheck=function(){return this.repeatPW.text!=this.password.text?(this.lhintRP.text=" 请重复密码 ",this.lhintRP.visible=!0,!1):(this.lhintRP.visible=!1,!0)},t.prototype.clueNameCheck=function(){var e=new RegExp("^[一-龥!-~]{1,18}$");return e.test(this.clueName.text)?(this.lhintCN.visible=!1,!0):(this.lhintCN.text=" 不能使用空格或为空 ",this.lhintCN.visible=!0,!1)},t.prototype.btnSubmitHandler=function(){var e=!1;if(this.userNameCheck()&&this.passwordCheck()&&this.repeatPWCheck()&&this.clueNameCheck()&&(e=!0),e){var t={type:"changePW",username:"",password:"",cluename:""};t.username=this.userName.text,t.password=this.password.text,t.cluename=this.clueName.text,this.httppost(ChangePWSrv,t)}},t.prototype.changePWSuccess=function(e){console.log(e+" 修改成功！");var t=new LOBBYEVENT(LOBBYEVENT.OPEN);t.pageName="Login",t.username=e,this.dispatchEvent(t),this.closePanel()},t.prototype.changePWFailed=function(e){e.username&&(this.lhintUN.text=e.username,this.lhintUN.visible=!0),e.password&&(this.lhintPW.text=e.password,this.lhintPW.visible=!0),e.cluename&&(this.lhintCN.text=e.cluename,this.lhintCN.visible=!0),Toast.launch("修改失败 "+e.msg)},t.prototype.httppost=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json");var s=JSON.stringify(t);i.send(s),i.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),i.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget,i=JSON.parse(t.response);if(i.type)switch(i.type){case"changePW":this.changePWSuccess(i.username);break;case"error":this.changePWFailed(i.error)}},t.prototype.onPostIOError=function(e){Toast.launch("IOError"),console.log("post error : "+e)},t.prototype.onPostProgress=function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},t.prototype.closePanel=function(){this.userName.text="",this.password.text="",this.repeatPW.text="",this.clueName.text="",this.lhintUN.visible=!1,this.lhintPW.visible=!1,this.lhintRP.visible=!1,this.lhintCN.visible=!1,this.parent.removeChild(this)},t}(eui.Component);__reflect(FindPW.prototype,"FindPW",["eui.UIComponent","egret.DisplayObject"]);var Game=function(e){function t(){var t=e.call(this)||this;return t.gameInfo={},t.bwidth=700,t.bmargin=5,t.pwidth=60,t.ewidth=172,t.fwidth=62,t.twidth=50,t.gameMove={currentPieceName:"",currentSkill:"",currentTargets:[]},t.targets=[],t.confirmTargets=[],t.boards=[],t.Pnamelist=["A","B","C","D","E","F","G","H","I","J","K"],t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Game.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.init()},t.prototype.init=function(){this.initBoard();var e=new Notation;this.notation=e,this.setupwithNotation(this.notation),this.boardcancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clearMoves,this),this.showdead.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showgraveyard,this),this.graveyardClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidegraveyard,this),this.reviveCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidereviveZone,this),this.confirmTargetButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendMoves,this)},t.prototype.showgraveyard=function(){this.graveyard.visible=!0},t.prototype.hidegraveyard=function(){this.graveyard.visible=!1},t.prototype.hidereviveZone=function(){this.reviveZone.visible=!1},t.prototype.setBoardColor=function(e){var t=[6723891,13395456,3368601,6697830];e<=t.length&&e>0?this.boardcancel.strokeColor=t[e-1]:this.boardcancel.strokeColor=0},t.prototype.initBoard=function(){for(var e=["A0","A10","K0","K10"],t=["A1","K1"],i=["A9","K9"],s=["B0","B10"],n=["J0","J10"],r=["F1","K1","B5","F5","G6","K6","B10","G10"],o=["A1","F1","F5","J5","A6","E6","E10","J10"],a=["B0","G0","G4","K4","B5","F5","F9","K9"],h=["E0","J0","A4","E4","F5","J5","A9","F9"],c=0;11>c;c++){this.boards.push([]);for(var l=0;11>l;l++){var p=new BoardPostion;p.Pname=this.Pnamelist[l]+c,p.Px=l,p.Py=c,0==c&&(p.up=0,p.connect[0]=0),10==c&&(p.down=0,p.connect[1]=0),0==l&&(p.left=0,p.connect[2]=0),10==l&&(p.right=0,p.connect[3]=0),e.indexOf(p.Pname)>-1&&(p.up=0,p.down=0,p.left=0,p.right=0,p.connect[0]=0,p.connect[1]=0,p.connect[2]=0,p.connect[3]=0),t.indexOf(p.Pname)>-1&&(p.up=0,p.connect[0]=0),i.indexOf(p.Pname)>-1&&(p.down=0,p.connect[1]=0),s.indexOf(p.Pname)>-1&&(p.left=0,p.connect[2]=0),n.indexOf(p.Pname)>-1&&(p.right=0,p.connect[3]=0),r.indexOf(p.Pname)>-1&&(p.leftup=1,p.connect[4]=1),o.indexOf(p.Pname)>-1&&(p.rightup=1,p.connect[5]=1),a.indexOf(p.Pname)>-1&&(p.leftdown=1,p.connect[6]=1),h.indexOf(p.Pname)>-1&&(p.rightdown=1,p.connect[7]=1),this.boards[c].push(p)}}},t.prototype.setupwithNotation=function(e){for(var t=0;11>t;t++)for(var i=0;11>i;i++)this.boards[t][i].Piece&&0==this.boards[t][i].Piece.LDE&&(this.BoardLayer.removeChild(this.boards[t][i].Piece),this.boards[t][i].Piece=null);this.graveA.removeChildren(),this.graveE.removeChildren(),this.graveF.removeChildren(),this.graveW.removeChildren();for(var s=0;s<e.currentPostions.length;s++){var n=new Piece(e.currentPostions[s].belong,e.currentPostions[s].pieceName,e.currentPostions[s].revive);if(n.LDE=e.currentPostions[s].LDE,n.Px=e.currentPostions[s].Px,n.Py=e.currentPostions[s].Py,n.Pname=this.boards[n.Py][n.Px].Pname,n.name=n.pieceName,n.x=this.Px2x(n.Px),n.y=this.Px2x(n.Py),0==n.LDE)n.piece.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pieceTapHandler.bind(this,n,!1),this),n.skill.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skillTapHandler.bind(this,n,!1),this),this.boards[n.Py][n.Px].Piece=n,this.BoardLayer.addChild(n);else if(1==n.LDE){var r=new eui.Image;r.source=n.p.source,r.width=40,r.height=40,r.y=0,r.name=n.pieceName,1==n.belong?(r.x=45*this.graveA.numChildren,this.graveA.addChild(r)):2==n.belong?(r.x=45*this.graveF.numChildren,this.graveF.addChild(r)):3==n.belong?(r.x=45*this.graveW.numChildren,this.graveW.addChild(r)):4==n.belong&&(r.x=45*this.graveE.numChildren,this.graveE.addChild(r)),this.BoardLayer.addChild(n),n.visible=!1}else this.BoardLayer.addChild(n),n.visible=!1}this.setRestrict(e.currentStats.restrict),this.checkEFI(),this.setBoardColor(e.currentPlayer)},t.prototype.SyncNotation=function(e){this.notation.currentPostions=e.currentPostions,this.notation.lastMove=e.lastMove,this.notation.currentPlayer=e.currentPlayer,this.notation.currentStats=e.currentStats,this.notation.NotationHistory=e.NotationHistory},t.prototype.Px2x=function(e){return e*(this.bwidth-2*(this.pwidth/2+this.bmargin))/10+(this.pwidth/2+this.bmargin)-this.pwidth/2},t.prototype.Px2xE=function(e){return e*(this.bwidth-2*(this.pwidth/2+this.bmargin))/10+(this.pwidth/2+this.bmargin)-this.ewidth/2},t.prototype.Px2xF=function(e){return e*(this.bwidth-2*(this.pwidth/2+this.bmargin))/10+(this.pwidth/2+this.bmargin)-this.fwidth/2},t.prototype.Px2xT=function(e){return e*(this.bwidth-2*(this.pwidth/2+this.bmargin))/10+(this.pwidth/2+this.bmargin)-this.twidth/2},t.prototype.pieceTapHandler=function(e){this.currentSelectedPiece&&this.clearMoves(),e.belong==this.notation.currentPlayer&&(this.showMoves(e),e.skillname=this.skillbutton(e),console.log(e.skillname),""==e.skillname?e.skill.visible=!1:e.skill.visible=!0)},t.prototype.skillbutton=function(e){var t=e.Py,i=e.Px,s=this.boards[t][i];if("D"==e.pieceType&&0==e.restricted){if(5==e.Py&&5==e.Px)return"Restrict"}else if("N"==e.pieceType&&0==e.restricted){if(5==e.Py&&5==e.Px)return"Resurrection";if(e.belong%2==1&&s.Ffield+s.Efield+s.Fenchant+s.Eenchant==0||e.belong%2==0&&s.Afield+s.Wfield+s.Aenchant+s.Wenchant==0)return"Reincarnation"}else if("I"==e.pieceType&&0==e.restricted){if(e.belong%2==1&&s.Ffield+s.Efield+s.Fenchant+s.Eenchant==0||e.belong%2==0&&s.Afield+s.Wfield+s.Aenchant+s.Wenchant==0){if(!this.boards[5][5].Piece||"I"!=this.boards[5][5].Piece.pieceType)return"Transposition";if((this.boards[5][5].Piece.belong-e.belong+4)%2==0)return"Entanglement"}}else if("S"==e.pieceType&&0==e.restricted){for(var n=!1,r=0;r<this.notation.currentPostions.length;r++)"M"==this.notation.currentPostions[r].pieceType&&this.notation.currentPostions[r].belong==e.belong&&0==this.notation.currentPostions[r].LDE&&(n=!0);if(!n){if(5==e.Py&&5==e.Px)return"Convene";if(e.belong%2==1&&s.Ffield+s.Efield+s.Fenchant+s.Eenchant==0||e.belong%2==0&&s.Afield+s.Wfield+s.Aenchant+s.Wenchant==0)return"Summon"}}return""},t.prototype.showResurrectionPostions=function(e,t){this.hidereviveZone();for(var i=0;11>i;i++)for(var s=0;11>s;s++)0==s&&0==i||10==s&&10==i||10==s&&0==i||0==s&&10==i||this.boards[i][s].Piece||(e.belong%2==0&&this.boards[i][s].Aenchant+this.boards[i][s].Wenchant+this.boards[i][s].Afield+this.boards[i][s].Wfield==0?this.putaMagicAt(s,i):e.belong%2==1&&this.boards[i][s].Fenchant+this.boards[i][s].Eenchant+this.boards[i][s].Ffield+this.boards[i][s].Efield==0&&this.putaMagicAt(s,i));this.gameMove.currentSkill="Resurrection",this.gameMove.currentTargets.push({targetPiece:t})},t.prototype.showReincarnationPostions=function(e,t){this.hidereviveZone();for(var i=-1;2>i;i++)for(var s=-1;2>s;s++){var n=s+e.Px,r=i+e.Py;0==n&&0==r||10==n&&10==r||10==n&&0==r||0==n&&10==r||n>=0&&10>=n&&r>=0&&10>=r&&(this.boards[r][n].Piece||(e.belong%2==0&&this.boards[r][n].Aenchant+this.boards[r][n].Wenchant+this.boards[r][n].Afield+this.boards[r][n].Wfield==0?this.putaMagicAt(n,r):e.belong%2==1&&this.boards[r][n].Fenchant+this.boards[r][n].Eenchant+this.boards[r][n].Ffield+this.boards[r][n].Efield==0&&this.putaMagicAt(n,r)))}this.gameMove.currentSkill="Reincarnation",this.gameMove.currentTargets.push({targetPiece:t})},t.prototype.skillTapHandler=function(e){switch(this.currentSelectedPiece&&this.clearMoves(),e.skillname){case"Restrict":for(var t=0;t<this.notation.currentPostions.length;t++)(0==this.notation.currentPostions[t].LDE&&this.notation.currentPostions[t].belong-e.belong+4)%2==1&&"W"!=this.notation.currentPostions[t].pieceType&&"M"!=this.notation.currentPostions[t].pieceType[0]&&(this.putaMagicAt(this.notation.currentPostions[t].Px,this.notation.currentPostions[t].Py),this.gameMove.currentSkill="Restrict");break;case"Resurrection":this.bordies.removeChildren();for(var t=0;t<this.notation.currentPostions.length;t++)if(this.notation.currentPostions[t].belong==e.belong&&1==this.notation.currentPostions[t].LDE){var i=new eui.Image;i.name=this.notation.currentPostions[t].pieceName,i.source="resource/pic/game/"+i.name+"r.png",i.width=70,i.height=70,i.y=0,i.x=80*this.bordies.numChildren,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showResurrectionPostions.bind(this,e,i.name,!1),this),this.bordies.addChild(i)}0==this.bordies.numChildren?this.cantReviveTip.visible=!0:this.cantReviveTip.visible=!1,this.reviveZone.visible=!0;break;case"Reincarnation":this.bordies.removeChildren();for(var t=0;t<this.notation.currentPostions.length;t++)if(this.notation.currentPostions[t].belong==e.belong&&1==this.notation.currentPostions[t].LDE){var i=new eui.Image;i.name=this.notation.currentPostions[t].pieceName,i.source="resource/pic/game/"+i.name+"r.png",i.width=70,i.height=70,i.y=0,i.x=80*this.bordies.numChildren,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showReincarnationPostions.bind(this,e,i.name,!1),this),this.bordies.addChild(i)}0==this.bordies.numChildren?this.cantReviveTip.visible=!0:this.cantReviveTip.visible=!1,this.reviveZone.visible=!0;break;case"Entanglement":for(var t=0;t<this.notation.currentPostions.length;t++)if(0==this.notation.currentPostions[t].LDE&&(this.notation.currentPostions[t].belong-e.belong+4)%2==0&&"W"!=this.notation.currentPostions[t].pieceType&&this.notation.currentPostions[t].pieceName!=e.pieceName){var s=this.notation.currentPostions[t].Py,n=this.notation.currentPostions[t].Px;e.belong%2==0&&this.boards[s][n].Aenchant+this.boards[s][n].Wenchant+this.boards[s][n].Afield+this.boards[s][n].Wfield==0?this.putaMagicAt(n,s):e.belong%2==1&&this.boards[s][n].Fenchant+this.boards[s][n].Eenchant+this.boards[s][n].Ffield+this.boards[s][n].Efield==0&&this.putaMagicAt(n,s),this.gameMove.currentSkill="Entanglement"}break;case"Transposition":for(var t=0;t<this.notation.currentPostions.length;t++)if(0==this.notation.currentPostions[t].LDE&&this.notation.currentPostions[t].belong==e.belong&&"W"!=this.notation.currentPostions[t].pieceType&&this.notation.currentPostions[t].pieceName!=e.pieceName){var r=this.notation.currentPostions[t].Py,o=this.notation.currentPostions[t].Px;e.belong%2==0&&this.boards[r][o].Aenchant+this.boards[r][o].Wenchant+this.boards[r][o].Afield+this.boards[r][o].Wfield==0?this.putaMagicAt(o,r):e.belong%2==1&&this.boards[r][o].Fenchant+this.boards[r][o].Eenchant+this.boards[r][o].Ffield+this.boards[r][o].Efield==0&&this.putaMagicAt(o,r),this.gameMove.currentSkill="Transposition"}break;case"Convene":for(var a=0;11>a;a++)for(var h=0;11>h;h++)0==h&&0==a||10==h&&10==a||10==h&&0==a||0==h&&10==a||this.boards[a][h].Piece||(e.belong%2==0&&this.boards[a][h].Aenchant+this.boards[a][h].Wenchant+this.boards[a][h].Afield+this.boards[a][h].Wfield==0?this.putaMagicAt(h,a):e.belong%2==1&&this.boards[a][h].Fenchant+this.boards[a][h].Eenchant+this.boards[a][h].Ffield+this.boards[a][h].Efield==0&&this.putaMagicAt(h,a),this.gameMove.currentSkill="Convene");break;case"Summon":for(var c=-1;2>c;c++)for(var l=-1;2>l;l++){var p=l+e.Px,d=c+e.Py;0==p&&0==d||10==p&&10==d||10==p&&0==d||0==p&&10==d||p>=0&&10>=p&&d>=0&&10>=d&&(this.boards[d][p].Piece||(e.belong%2==0&&this.boards[d][p].Aenchant+this.boards[d][p].Wenchant+this.boards[d][p].Afield+this.boards[d][p].Wfield==0?this.putaMagicAt(p,d):e.belong%2==1&&this.boards[d][p].Fenchant+this.boards[d][p].Eenchant+this.boards[d][p].Ffield+this.boards[d][p].Efield==0&&this.putaMagicAt(p,d),this.gameMove.currentSkill="Summon"))}}},t.prototype.showMoves=function(e){this.currentSelectedPiece=e,e.setSelect(!0);for(var t=0;8>t;t++)if(1==this.boards[e.Py][e.Px].connect[t]){var i=!1,s=e.maxmoves,n=e.Px,r=e.Py;"E"==e.pieceType&&5==e.Py&&5==e.Px?s=5:"D"==e.pieceType&&0==e.restricted||(e.belong%2==1&&this.boards[r][n].Ffield+this.boards[r][n].Efield>0?i=!0:e.belong%2==0&&this.boards[r][n].Afield+this.boards[r][n].Wfield>0&&(i=!0));for(var o=1;s>=o&&0==i;o++){switch(n=e.Px,r=e.Py,t){case 0:r-=o;break;case 1:r+=o;break;case 2:n-=o;break;case 3:n+=o;break;case 4:n-=o,r-=o;break;case 5:n+=o,r-=o;break;case 6:n-=o,r+=o;break;case 7:n+=o,r+=o}if("D"==e.pieceType&&0==e.restricted)null!=this.boards[r][n].Piece?(this.boards[r][n].Piece.belong-e.belong+4)%2==0?i=!0:(this.putaAttackAt(n,r),i=!0):this.putaDestinationAt(n,r);
else if("E"==e.pieceType&&5==e.Py&&5==e.Px)null!=this.boards[r][n].Piece?(this.boards[r][n].Piece.belong-e.belong+4)%2==0?1==this.boards[r][n].Piece.invisable||(i=!0):(this.boards[r][n].Piece.belong-e.belong+4)%2==1&&(1==this.boards[r][n].Piece.invisable?this.putaAttackAt(n,r):(this.putaAttackAt(n,r),i=!0)):this.putaDestinationAt(n,r);else if("I"==e.pieceType&&0==e.restricted)e.belong%2==1&&this.boards[r][n].Ffield+this.boards[r][n].Efield>0?i=!0:e.belong%2==0&&this.boards[r][n].Afield+this.boards[r][n].Wfield>0?i=!0:null!=this.boards[r][n].Piece?e.belong%2==1&&this.boards[r][n].Fenchant+this.boards[r][n].Eenchant>0?i=!0:e.belong%2==0&&this.boards[r][n].Aenchant+this.boards[r][n].Wenchant>0&&(i=!0):this.putaDestinationAt(n,r);else if(e.belong%2==1&&this.boards[r][n].Ffield+this.boards[r][n].Efield>0)i=!0;else if(e.belong%2==0&&this.boards[r][n].Afield+this.boards[r][n].Wfield>0)i=!0;else if(null!=this.boards[r][n].Piece){if(1==this.boards[r][n].Piece.invisable);else if((this.boards[r][n].Piece.belong-e.belong+4)%2==0)i=!0;else if((this.boards[r][n].Piece.belong-e.belong+4)%2==1){for(var a=!1,h=0;h<this.notation.currentPostions.length;h++)"M"==this.notation.currentPostions[h].pieceType&&this.notation.currentPostions[h].belong==e.belong&&0==this.notation.currentPostions[h].LDE&&(a=!0);"I"==e.pieceType?i=!0:"S"==e.pieceType&&a?i=!0:(this.putaAttackAt(n,r),i=!0)}}else this.putaDestinationAt(n,r);0==this.boards[r][n].connect[t]&&(i=!0)}}},t.prototype.clearMoves=function(){if(this.currentSelectedPiece){this.currentSelectedPiece.setSelect(!1),this.currentSelectedPiece.skill.visible=!1,this.gameMove.currentSkill="";for(var e=0;e<this.targets.length;e++)this.BoardLayer.removeChild(this.targets[e]);for(var e=0;e<this.confirmTargets.length;e++)this.BoardLayer.removeChild(this.confirmTargets[e]);this.targets=[],this.confirmTargets=[],this.gameMove.currentPieceName="",this.gameMove.currentSkill="",this.gameMove.currentTargets=[],this.confirmTargetButton.visible=!1}},t.prototype.DestinationTapHandler=function(e){if(this.confirmTargets.length>0)this.sendMoves();else{for(var t=this.targets.length;t>0;t--){var i=this.targets.pop();if(this.BoardLayer.removeChild(i),i==e){var s={Px:i.Px,Py:i.Py};this.gameMove.currentPieceName=this.currentSelectedPiece.pieceName,this.boards[i.Py][i.Px].Piece?(this.gameMove.currentSkill="kill",this.gameMove.currentTargets.push({targetPiece:this.boards[i.Py][i.Px].Piece.pieceName}),this.gameMove.currentTargets.push(s)):(this.gameMove.currentSkill="move",this.gameMove.currentTargets.push(s)),this.confirmTargets.push(i),this.BoardLayer.addChild(i)}}this.confirmTargetButton.visible=!0}},t.prototype.OneMagicTarget=function(e){if(this.confirmTargets.length>0)this.sendMoves();else{("Restrict"==this.gameMove.currentSkill||"Entanglement"==this.gameMove.currentSkill||"Transposition"==this.gameMove.currentSkill)&&this.gameMove.currentTargets.push({targetPiece:this.boards[e.Py][e.Px].Piece.pieceName}),("Reincarnation"==this.gameMove.currentSkill||"Resurrection"==this.gameMove.currentSkill)&&(e.targeting.source="resource/pic/game/"+this.gameMove.currentTargets[0].targetPiece+"rs.png",e.targeting.width=e.targeting.height=60);for(var t=this.targets.length;t>0;t--){var i=this.targets.pop();if(this.BoardLayer.removeChild(i),i==e){var s={Px:i.Px,Py:i.Py};this.gameMove.currentPieceName=this.currentSelectedPiece.pieceName,this.gameMove.currentTargets.push(s);var n={Px:this.currentSelectedPiece.Px,Py:this.currentSelectedPiece.Py};this.gameMove.currentTargets.push(n),this.confirmTargets.push(i),this.BoardLayer.addChild(i)}}this.confirmTargetButton.visible=!0}},t.prototype.SummonTarget=function(e){var t={Px:e.Px,Py:e.Py},i=[];if(e.hold){e.targeting.source="resource/pic/game/skilltarget.png",e.targeting.width=e.targeting.height=42,e.hold=!1;for(var s=this.gameMove.currentTargets.length;s>0;s--){var n=this.gameMove.currentTargets.pop();(n.Px!=t.Px||n.Py!=t.Py)&&i.push(n)}this.gameMove.currentTargets=i}else this.gameMove.currentTargets.length<4&&(e.targeting.source="resource/pic/game/"+this.currentSelectedPiece.pieceName[0]+"Mrs.png",e.targeting.width=e.targeting.height=60,e.hold=!0,this.gameMove.currentTargets.push(t));this.gameMove.currentTargets.length>0?this.confirmTargetButton.visible=!0:this.confirmTargetButton.visible=!1,console.log(JSON.stringify(this.gameMove))},t.prototype.MagicTapHandler=function(e){switch(this.currentSelectedPiece&&(this.gameMove.currentPieceName=this.currentSelectedPiece.pieceName),this.gameMove.currentSkill){case"Restrict":this.OneMagicTarget(e);break;case"Resurrection":this.OneMagicTarget(e);break;case"Reincarnation":this.OneMagicTarget(e);break;case"Entanglement":this.OneMagicTarget(e);break;case"Transposition":this.OneMagicTarget(e);break;case"Convene":this.gameMove.currentPieceName=this.currentSelectedPiece.pieceName,this.SummonTarget(e);break;case"Summon":this.gameMove.currentPieceName=this.currentSelectedPiece.pieceName,this.SummonTarget(e)}},t.prototype.putaDestinationAt=function(e,t){var i=new Target(1,e,t);i.x=this.Px2xT(e),i.y=this.Px2xT(t),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.DestinationTapHandler.bind(this,i,!1),this),this.targets.push(i),this.BoardLayer.addChild(i)},t.prototype.putaMagicAt=function(e,t){var i=new Target(2,e,t);i.x=this.Px2xT(e),i.y=this.Px2xT(t),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.MagicTapHandler.bind(this,i,!1),this),this.targets.push(i),this.BoardLayer.addChild(i)},t.prototype.putaAttackAt=function(e,t){this.putaDestinationAt(e,t)},t.prototype.putEnchantAt=function(e,t,i){var s=["x","A","F","W","E"],n="resource/pic/game/"+s[e]+"Enchant.png",r=new eui.Image(n);r.width=this.ewidth,r.height=this.ewidth,r.x=this.Px2xE(t),r.y=this.Px2xE(i),r.name=s[e]+"Enchant",this.EFlayer.getChildByName(r.name)||this.EFlayer.addChild(r)},t.prototype.putFieldAt=function(e,t,i,s){var n=["x","A","F","W","E"],r="resource/pic/game/"+n[e]+"field.png";s&&(r="resource/pic/game/"+n[e]+"fieldmain.png");var o=new eui.Image(r);o.width=this.fwidth,o.height=this.fwidth,o.x=this.Px2xF(t),o.y=this.Px2xF(i),this.EFlayer.addChild(o)},t.prototype.clearEnchant=function(e){var t=["x","A","F","W","E"],i=t[e]+"Enchant";this.EFlayer.getChildByName(i)&&this.EFlayer.removeChild(this.EFlayer.getChildByName(i))},t.prototype.clearEF=function(){this.EFlayer.removeChildren()},t.prototype.findSurround=function(e,t,i){for(var s=!1,n=-1;2>n;n++)for(var r=-1;2>r;r++){var o=e+r,a=t+n;o>=0&&10>=o&&a>=0&&10>=a&&this.boards[a][o].Piece&&this.boards[a][o].Piece.pieceName==i&&(s=!0)}return s},t.prototype.setRestrict=function(e){if(""==e){for(var t=0;t<this.notation.currentPostions.length;t++)if(this.BoardLayer.getChildByName(this.notation.currentPostions[t].pieceName)){var i=this.BoardLayer.getChildByName(this.notation.currentPostions[t].pieceName);i.setRestrict(!1)}}else{var i=this.BoardLayer.getChildByName(e);i.setRestrict(!0)}},t.prototype.checkEFI=function(){for(var e=0;11>e;e++)for(var t=0;11>t;t++)this.boards[e][t].Aenchant=0,this.boards[e][t].Fenchant=0,this.boards[e][t].Wenchant=0,this.boards[e][t].Eenchant=0,this.boards[e][t].Afield=0,this.boards[e][t].Ffield=0,this.boards[e][t].Wfield=0,this.boards[e][t].Efield=0;this.clearEF();var i=this.BoardLayer.getChildByName("AD");if(0==i.restricted&&0==i.LDE){for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=i.Px+n,o=i.Py+s;r>=0&&10>=r&&o>=0&&10>=o&&(this.boards[o][r].Aenchant=1)}this.putEnchantAt(1,i.Px,i.Py)}var a=this.BoardLayer.getChildByName("FD");if(0==a.restricted&&0==a.LDE){for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=a.Px+n,o=a.Py+s;r>=0&&10>=r&&o>=0&&10>=o&&(this.boards[o][r].Fenchant=1)}this.putEnchantAt(2,a.Px,a.Py)}var h=this.BoardLayer.getChildByName("WD");if(0==h.restricted&&0==h.LDE){for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=h.Px+n,o=h.Py+s;r>=0&&10>=r&&o>=0&&10>=o&&(this.boards[o][r].Wenchant=1)}this.putEnchantAt(3,h.Px,h.Py)}var c=this.BoardLayer.getChildByName("ED");if(0==c.restricted&&0==c.LDE){for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=c.Px+n,o=c.Py+s;r>=0&&10>=r&&o>=0&&10>=o&&(this.boards[o][r].Eenchant=1)}this.putEnchantAt(4,c.Px,c.Py)}var l=this.BoardLayer.getChildByName("AP");if(0==l.LDE&&5==l.Px&&5==l.Py)for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=l.Px+n,o=l.Py+s;0==this.boards[o][r].Fenchant&&0==this.boards[o][r].Eenchant&&(this.boards[o][r].Afield=1,0==n&&0==s?this.putFieldAt(1,r,o,!0):this.putFieldAt(1,r,o,!1))}else 0==l.restricted&&0==l.LDE&&0==this.boards[l.Py][l.Px].Fenchant&&0==this.boards[l.Py][l.Px].Eenchant&&this.findSurround(l.Px,l.Py,"AW")&&(this.boards[l.Py][l.Px].Afield=1,this.putFieldAt(1,l.Px,l.Py,!0),l.Px-1>=0&&0==this.boards[l.Py][l.Px-1].Fenchant&&0==this.boards[l.Py][l.Px-1].Eenchant&&(this.boards[l.Py][l.Px-1].Afield=1,this.putFieldAt(1,l.Px-1,l.Py,!0)),l.Px+1<=10&&0==this.boards[l.Py][l.Px+1].Fenchant&&0==this.boards[l.Py][l.Px+1].Eenchant&&(this.boards[l.Py][l.Px+1].Afield=1,this.putFieldAt(1,l.Px+1,l.Py,!0)));var p=this.BoardLayer.getChildByName("FP");if(0==p.LDE&&5==p.Px&&5==p.Py)for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=p.Px+n,o=p.Py+s;0==this.boards[o][r].Aenchant&&0==this.boards[o][r].Wenchant&&(this.boards[o][r].Ffield=1,0==n&&0==s?this.putFieldAt(2,r,o,!0):this.putFieldAt(2,r,o,!1))}else 0==p.restricted&&0==p.LDE&&0==this.boards[p.Py][p.Px].Aenchant&&0==this.boards[p.Py][p.Px].Wenchant&&this.findSurround(p.Px,p.Py,"FW")&&(this.boards[p.Py][p.Px].Ffield=1,this.putFieldAt(2,p.Px,p.Py,!0),p.Py-1>=0&&0==this.boards[p.Py-1][p.Px].Aenchant&&0==this.boards[p.Py-1][p.Px].Wenchant&&(this.boards[p.Py-1][p.Px].Ffield=1,this.putFieldAt(2,p.Px,p.Py-1,!1)),p.Py+1<=10&&0==this.boards[p.Py+1][p.Px].Aenchant&&0==this.boards[p.Py+1][p.Px].Wenchant&&(this.boards[p.Py+1][p.Px].Ffield=1,this.putFieldAt(2,p.Px,p.Py+1,!1)));var d=this.BoardLayer.getChildByName("WP");if(0==d.LDE&&5==d.Px&&5==d.Py)for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=d.Px+n,o=d.Py+s;0==this.boards[o][r].Fenchant&&0==this.boards[o][r].Eenchant&&(this.boards[o][r].Wfield=1,0==n&&0==s?this.putFieldAt(3,r,o,!0):this.putFieldAt(3,r,o,!1))}else 0==d.restricted&&0==d.LDE&&0==this.boards[d.Py][d.Px].Fenchant&&0==this.boards[d.Py][d.Px].Eenchant&&this.findSurround(d.Px,d.Py,"WW")&&(this.boards[d.Py][d.Px].Wfield=1,this.putFieldAt(3,d.Px,d.Py,!0),d.Px-1>=0&&0==this.boards[d.Py][d.Px-1].Fenchant&&0==this.boards[d.Py][d.Px-1].Eenchant&&(this.boards[d.Py][d.Px-1].Wfield=1,this.putFieldAt(3,d.Px-1,d.Py,!1)),d.Px+1<=10&&0==this.boards[d.Py][d.Px+1].Fenchant&&0==this.boards[d.Py][d.Px+1].Eenchant&&(this.boards[d.Py][d.Px+1].Wfield=1,this.putFieldAt(3,d.Px+1,d.Py,!1)));var u=this.BoardLayer.getChildByName("EP");if(0==u.LDE&&5==u.Px&&5==u.Py)for(var s=-1;2>s;s++)for(var n=-1;2>n;n++){var r=u.Px+n,o=u.Py+s;0==this.boards[o][r].Aenchant&&0==this.boards[o][r].Wenchant&&(this.boards[o][r].Efield=1,0==n&&0==s?this.putFieldAt(4,r,o,!0):this.putFieldAt(4,r,o,!1))}else 0==u.restricted&&0==u.LDE&&0==this.boards[u.Py][u.Px].Aenchant&&0==this.boards[u.Py][u.Px].Wenchant&&this.findSurround(u.Px,u.Py,"EW")&&(this.boards[u.Py][u.Px].Efield=1,this.putFieldAt(4,u.Px,u.Py,!0),u.Py-1>=0&&0==this.boards[u.Py-1][u.Px].Aenchant&&0==this.boards[u.Py-1][u.Px].Wenchant&&(this.boards[u.Py-1][u.Px].Efield=1,this.putFieldAt(4,u.Px,u.Py-1,!1)),u.Py+1<=10&&0==this.boards[u.Py+1][u.Px].Aenchant&&0==this.boards[u.Py+1][u.Px].Wenchant&&(this.boards[u.Py+1][u.Px].Efield=1,this.putFieldAt(4,u.Px,u.Py+1,!1)));var m=this.BoardLayer.getChildByName("AI");0==m.restricted&&0==m.LDE&&0==this.boards[m.Py][m.Px].Fenchant&&0==this.boards[m.Py][m.Px].Eenchant&&0==this.boards[m.Py][m.Px].Ffield&&0==this.boards[m.Py][m.Px].Efield?m.setInvisable(!0):m.setInvisable(!1);var v=this.BoardLayer.getChildByName("FI");0==v.restricted&&0==v.LDE&&0==this.boards[v.Py][v.Px].Aenchant&&0==this.boards[v.Py][v.Px].Wenchant&&0==this.boards[v.Py][v.Px].Afield&&0==this.boards[v.Py][v.Px].Wfield?v.setInvisable(!0):v.setInvisable(!1);var g=this.BoardLayer.getChildByName("WI");0==g.restricted&&0==g.LDE&&0==this.boards[g.Py][g.Px].Fenchant&&0==this.boards[g.Py][g.Px].Eenchant&&0==this.boards[g.Py][g.Px].Ffield&&0==this.boards[g.Py][g.Px].Efield?g.setInvisable(!0):g.setInvisable(!1);var y=this.BoardLayer.getChildByName("EI");0==y.restricted&&0==y.LDE&&0==this.boards[y.Py][y.Px].Aenchant&&0==this.boards[y.Py][y.Px].Wenchant&&0==this.boards[y.Py][y.Px].Afield&&0==this.boards[y.Py][y.Px].Wfield?y.setInvisable(!0):y.setInvisable(!1)},t.prototype.sendMoves=function(){var e={username:username,token:token,roomID:this.gameInfo.roomID,gameID:this.gameInfo.gameID,notation:this.notation,gameMove:this.gameMove};socket.emit("GameMove",e),this.clearMoves()},t}(eui.Component);__reflect(Game.prototype,"Game",["eui.UIComponent","egret.DisplayObject"]);var GAMEEVENT=function(e){function t(t,i,s){return void 0===i&&(i=!1),void 0===s&&(s=!1),e.call(this,t,i,s)||this}return __extends(t,e),t.PIECESELECTED="PIECESELECTED",t.SELECTEDCANCELED="SELECTEDCANCELED",t}(egret.Event);__reflect(GAMEEVENT.prototype,"GAMEEVENT");var GameItem=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/GameItem.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){this.gameName.text=this.data.gameName,0==this.data.gameDate&&(this.gameDate.text="")},t.prototype.uiCompHandler=function(){this.addListeners(),this.init()},t.prototype.addListeners=function(){this.roomEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,this.roomEnterHandler,this)},t.prototype.init=function(){},t.prototype.roomEnterHandler=function(){if(1==this.data.roomState)if(isLogin){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.data.roomID,socket.emit("EnterRoom",e),console.log("emit EnterRoom")}else Toast.launch("请先登录");else if(2==this.data.roomState){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.data.roomID,socket.emit("EnterGame",e),console.log("emit EnterGame")}else if(3==this.data.roomState){var t={username:"",token:"",gameID:""};t.username=username,t.token=token,t.gameID=this.data.gameID,socket.emit("ReviewNotation",t),console.log("emit ReviewNotation")}},t}(eui.ItemRenderer);__reflect(GameItem.prototype,"GameItem");var Home=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Home.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners(),this.init()},t.prototype.addListeners=function(){this.logo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logoHandler,this),this.person.addEventListener(egret.TouchEvent.TOUCH_TAP,this.personHandler,this),this.join.addEventListener(egret.TouchEvent.TOUCH_TAP,this.joinHandler,this),this.observe.addEventListener(egret.TouchEvent.TOUCH_TAP,this.observeHandler,this),this.history.addEventListener(egret.TouchEvent.TOUCH_TAP,this.historyHandler,this),this.create.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createHandler,this),this.searchCondition.addEventListener(egret.FocusEvent.FOCUS_IN,this.searchConditionHandler,this),this.search.addEventListener(egret.TouchEvent.TOUCH_TAP,this.searchHandler,this),this.clear.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clearHandler,this)},t.prototype.init=function(){this.refreshTime=2e3,this.dsRooms=[{roomID:123,roomState:1,gameName:"网络连接失败",hostName:"ruchaos",gameType:"1v1",gameTime:"快棋",gameDate:"20190615"},{roomID:124,roomState:1,gameName:"ruchaos 's game",hostName:"ruchaos",gameType:"1v1",gameTime:"快棋",gameDate:"20190615"},{roomID:125,roomState:1,gameName:"ruchaos 's game",hostName:"ruchaos",gameType:"1v1",gameTime:"快棋",gameDate:"20190615"}],this.dpRooms=new eui.ArrayCollection(this.dsRooms),this.rooms.dataProvider=this.dpRooms,this.rooms.itemRenderer=GameItem,this.joinHandler(),this.refreshRooms()},t.prototype.logoHandler=function(){},t.prototype.personHandler=function(){var e=new LOBBYEVENT(LOBBYEVENT.OPEN);isLogin?e.pageName="Person":e.pageName="Login",this.dispatchEvent(e)},t.prototype.joinHandler=function(){this.setBtnFocus(this.join),this.roomState=1},t.prototype.observeHandler=function(){this.setBtnFocus(this.observe),this.roomState=2},t.prototype.historyHandler=function(){this.setBtnFocus(this.history),this.roomState=3},t.prototype.createHandler=function(){if(isLogin){var e=new LOBBYEVENT(LOBBYEVENT.OPEN);e.pageName="Create",this.dispatchEvent(e)}else Toast.launch("请先登录")},t.prototype.searchConditionHandler=function(){},t.prototype.searchHandler=function(){this.searchRooms()},t.prototype.clearHandler=function(){this.searchCondition.text="",this.searchHandler()},t.prototype.searchRooms=function(){var e={type:"list",roomState:0,playerName:""};e.roomState=this.roomState,e.playerName=this.searchCondition.text.trim(),this.httppost(RoomSrv,e)},t.prototype.refreshRooms=function(){var e=this;this.searchRooms();var t=new egret.Timer(this.refreshTime,0);t.addEventListener(egret.TimerEvent.TIMER,function(){e.searchRooms()},this),t.start()},t.prototype.updateRoom=function(e){void 0===e&&(e=[]);var t;t=e;for(var i=0;i<e.length;i++)t[i].gameType=gameTypeNo[e[i].gameType-1],t[i].gameTime=gameTimeNo[e[i].gameTime-1],(0==e[i].gameDate||"0"==e[i].gameDate)&&""==t[i].gameDate;this.dsRooms=t,this.dpRooms.replaceAll(this.dsRooms)},t.prototype.setBtnFocus=function(e){this.join.selected=!1,this.observe.selected=!1,this.history.selected=!1,e.selected=!0},t.prototype.httppost=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json");var s=JSON.stringify(t);i.send(s),i.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),i.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget,i=JSON.parse(t.response);if(i.type)switch(i.type){case"list":this.updateRoom(i.rooms)}},t.prototype.onPostIOError=function(e){console.log("post error : "+e)},t.prototype.onPostProgress=function(e){},t}(eui.Component);__reflect(Home.prototype,"Home",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var LOBBYEVENT=function(e){function t(t,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);var n=e.call(this,t,i,s)||this;return n.pageName="Home",n}return __extends(t,e),t.OPEN="OPEN_PAGE",t.LOGIN="LOGIN",t.LOGOUT="LOGOUT",t.ENTERROOM="ENTERROOM",t.SOCKETMSG="SOCKETMSG",t}(egret.Event);__reflect(LOBBYEVENT.prototype,"LOBBYEVENT");var Login=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Login.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners()},t.prototype.addListeners=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.curtain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.curtainHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.toRegister.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRegisterHandler,this),this.toChangePW.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toChangePWHandler,this)},t.prototype.curtainHandler=function(){this.closePanel()},t.prototype.btnCloseHandler=function(){this.closePanel()},t.prototype.btnSubmitHandler=function(){var e=!0;if(""==this.userName.text?(this.lhintUN.text=" 请填写用户名 ",this.lhintUN.visible=!0,e=!1):this.lhintUN.visible=!1,""==this.password.text?(this.lhintPW.text=" 请填写密码 ",this.lhintPW.visible=!0,e=!1):this.lhintPW.visible=!1,e){var t={type:"login",username:"",password:""};t.username=this.userName.text,t.password=this.password.text,this.httppost(LoginSrv,t)}},t.prototype.LoginSuccess=function(e){var t=new LOBBYEVENT(LOBBYEVENT.LOGIN);username=e,console.log(e+" 登录成功！"),this.dispatchEvent(t),this.closePanel()},t.prototype.LoginFailed=function(e){e.username&&(this.lhintUN.text=e.username,this.lhintUN.visible=!0),e.password&&(this.lhintPW.text=e.password,this.lhintPW.visible=!0),Toast.launch("登录失败 "+e.msg)},t.prototype.httppost=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json");var s=JSON.stringify(t);i.send(s),i.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),i.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget,i=JSON.parse(t.response);if(i.type)switch(i.type){case"login":this.LoginSuccess(i.username);break;case"error":this.LoginFailed(i.error)}},t.prototype.onPostIOError=function(e){Toast.launch("IOError"),console.log("post error : "+e)},t.prototype.onPostProgress=function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},t.prototype.toRegisterHandler=function(){var e=new LOBBYEVENT(LOBBYEVENT.OPEN);e.pageName="Register",this.dispatchEvent(e)},t.prototype.toChangePWHandler=function(){var e=new LOBBYEVENT(LOBBYEVENT.OPEN);e.pageName="FindPW",this.dispatchEvent(e)},t.prototype.closePanel=function(){this.userName.text="",this.password.text="",this.lhintUN.visible=!1,this.lhintPW.visible=!1,this.parent.removeChild(this)},t}(eui.Component);__reflect(Login.prototype,"Login",["eui.UIComponent","egret.DisplayObject"]);var BoardPostion=function(){function e(){this.Piece=null,this.connect=[1,1,1,1,0,0,0,0],this.up=1,this.down=1,this.left=1,this.right=1,this.leftup=0,this.rightup=0,this.leftdown=0,this.rightdown=0,this.Aenchant=0,this.Fenchant=0,this.Wenchant=0,this.Eenchant=0,this.Afield=0,this.Ffield=0,this.Wfield=0,this.Efield=0}return e}();__reflect(BoardPostion.prototype,"BoardPostion");var Notation=function(){function e(){this.currentPostions=[{pieceName:"AE",belong:1,pieceType:"E",revive:!1,LDE:0,Px:2,Py:0},{pieceName:"AD",belong:1,pieceType:"D",revive:!1,LDE:0,Px:3,Py:0},{pieceName:"AN",belong:1,pieceType:"N",revive:!1,LDE:0,Px:4,Py:0},{pieceName:"AW",belong:1,pieceType:"W",revive:!1,LDE:0,Px:5,Py:0},{pieceName:"AP",belong:1,pieceType:"P",revive:!1,LDE:0,Px:6,Py:0},{pieceName:"AI",belong:1,pieceType:"I",revive:!1,LDE:0,Px:7,Py:0},{pieceName:"AS",belong:1,pieceType:"S",revive:!1,LDE:0,Px:8,Py:0},{pieceName:"AM1",belong:1,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"AM2",belong:1,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"AM3",belong:1,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"AM4",belong:1,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"FE",belong:2,pieceType:"E",revive:!1,LDE:0,Px:0,Py:8},{pieceName:"FD",belong:2,pieceType:"D",revive:!1,LDE:0,Px:0,Py:7},{pieceName:"FN",belong:2,pieceType:"N",revive:!1,LDE:0,Px:0,Py:6},{pieceName:"FW",belong:2,pieceType:"W",revive:!1,LDE:0,Px:0,Py:5},{pieceName:"FP",belong:2,pieceType:"P",revive:!1,LDE:0,Px:0,Py:4},{pieceName:"FI",belong:2,pieceType:"I",revive:!1,LDE:0,Px:0,Py:3},{pieceName:"FS",belong:2,pieceType:"S",revive:!1,LDE:0,Px:0,Py:2},{pieceName:"FM1",belong:2,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"FM2",belong:2,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"FM3",belong:2,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"FM4",belong:2,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"WE",belong:3,pieceType:"E",revive:!1,LDE:0,Px:8,Py:10},{pieceName:"WD",belong:3,pieceType:"D",revive:!1,LDE:0,Px:7,Py:10},{pieceName:"WN",belong:3,pieceType:"N",revive:!1,LDE:0,Px:6,Py:10},{pieceName:"WW",belong:3,pieceType:"W",revive:!1,LDE:0,Px:5,Py:10},{pieceName:"WP",belong:3,pieceType:"P",revive:!1,LDE:0,Px:4,Py:10},{pieceName:"WI",belong:3,pieceType:"I",revive:!1,LDE:0,Px:3,Py:10},{pieceName:"WS",belong:3,pieceType:"S",revive:!1,LDE:0,Px:2,Py:10},{pieceName:"WM1",belong:3,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"WM2",belong:3,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"WM3",belong:3,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"WM4",belong:3,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"EE",belong:4,pieceType:"E",revive:!1,LDE:0,Px:10,Py:2},{pieceName:"ED",belong:4,pieceType:"D",revive:!1,LDE:0,Px:10,Py:3},{pieceName:"EN",belong:4,pieceType:"N",revive:!1,LDE:0,Px:10,Py:4},{pieceName:"EW",belong:4,pieceType:"W",revive:!1,LDE:0,Px:10,Py:5},{pieceName:"EP",belong:4,pieceType:"P",revive:!1,LDE:0,Px:10,Py:6},{pieceName:"EI",belong:4,pieceType:"I",revive:!1,LDE:0,Px:10,Py:7},{pieceName:"ES",belong:4,pieceType:"S",revive:!1,LDE:0,Px:10,Py:8},{pieceName:"EM1",belong:4,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"EM2",belong:4,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"EM3",belong:4,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0},{pieceName:"EM4",belong:4,pieceType:"M",revive:!0,LDE:2,Px:0,Py:0}],this.currentPlayer=1,this.lastMove={},this.currentStats={restrict:""},this.NotationHistory=[],this.addNotation(this)}return e.prototype.addNotation=function(e){var t={currentPlayer:e.currentPlayer,lastMove:e.lastMove,currentStats:e.currentStats,currentPostions:e.currentPostions};this.NotationHistory.push(t)},e.prototype.getNotation=function(e){var t={currentPlayer:this.NotationHistory[e].currentPlayer,lastMove:this.NotationHistory[e].lastMove,currentStats:this.NotationHistory[e].currentStats,currentPostions:this.NotationHistory[e].currentPostions};return t},e}();__reflect(Notation.prototype,"Notation");var Person=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Person.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners(),this.init()},t.prototype.addListeners=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.curtain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.curtainHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.toChangePW.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toChangePWHandler,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this)},t.prototype.init=function(){this.title.text="hi,"+username;var e={type:"record",username:""};e.username=username,this.httppost(RecordSrv,e)},t.prototype.httppost=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json");var s=JSON.stringify(t);i.send(s),i.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),i.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget,i=JSON.parse(t.response);if(i.type)switch(i.type){case"record":this.games.text="您已进行了"+i.record.toString()+"场游戏";break;case"error":this.games.text="错误，尚未查出您的战绩"}},t.prototype.onPostIOError=function(e){Toast.launch("IOError"),console.log("post error : "+e)},t.prototype.onPostProgress=function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},t.prototype.curtainHandler=function(){this.closePanel()},t.prototype.btnCloseHandler=function(){this.closePanel()},t.prototype.btnSubmitHandler=function(){var e=new LOBBYEVENT(LOBBYEVENT.LOGOUT);this.dispatchEvent(e),this.closePanel()},t.prototype.toChangePWHandler=function(){var e=new LOBBYEVENT(LOBBYEVENT.OPEN);e.pageName="ChangePW",this.dispatchEvent(e),this.closePanel()},t.prototype.closePanel=function(){this.parent.removeChild(this)},t}(eui.Component);__reflect(Person.prototype,"Person",["eui.UIComponent","egret.DisplayObject"]);var Piece=function(e){function t(t,i,s){var n=e.call(this)||this;n.skillname="",n.addEventListener(eui.UIEvent.COMPLETE,n.uiCompHandler,n),n.skinName="resource/custom_skins/Piece.exml",n.pieceName=i,n.pieceType=i[1];var r="";return r=s?i[0]+i[1]+"r":i[0]+i[1],n.p.source="resource/pic/game/"+r+".png",n.s.source="resource/pic/game/"+r+"s.png",n.selected=!1,n.belong=t,n.revive=s,n.restricted=!1,"W"==n.pieceType||"M"==n.pieceType?n.maxmoves=1:"N"==n.pieceType||"P"==n.pieceType?n.maxmoves=2:"D"==n.pieceType||"I"==n.pieceType?n.maxmoves=3:("E"==n.pieceType||"S"==n.pieceType)&&(n.maxmoves=4),"I"==n.pieceType?n.setInvisable(!0):n.setInvisable(!1),n.LDE=0,n}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.addListeners()},t.prototype.addListeners=function(){},t.prototype.switchSelect=function(){this.selected?(this.p.visible=!1,this.s.visible=!0):(this.s.visible=!1,this.p.visible=!0)},t.prototype.setSelect=function(e){this.selected=e,this.switchSelect()},t.prototype.setSelect1=function(){var e=new GAMEEVENT(GAMEEVENT.PIECESELECTED);e.pieceName=this.pieceName,e.pieceType=this.pieceType,e.pieceBelong=this.belong,e.piecePname=this.Pname,e.piecePx=this.Px,e.piecePy=this.Py,this.dispatchEvent(e),this.setSelect(!0)},t.prototype.setSelect0=function(){var e=new GAMEEVENT(GAMEEVENT.SELECTEDCANCELED);e.pieceName=this.pieceName,e.pieceType=this.pieceType,e.pieceBelong=this.belong,e.piecePname=this.Pname,e.piecePx=this.Px,e.piecePy=this.Py,this.dispatchEvent(e),this.setSelect(!1)},t.prototype.getSelect=function(){return this.selected},t.prototype.getName=function(){return this.pieceName},t.prototype.setInvisable=function(e){this.invisable=e,e?(this.p.alpha=.6,this.s.alpha=.6):(this.p.alpha=1,this.s.alpha=1)},t.prototype.setRestrict=function(e){this.restricted=e,this.restrict.visible=e},t}(eui.Component);__reflect(Piece.prototype,"Piece",["eui.UIComponent","egret.DisplayObject"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Srv="http://192.168.31.15:8080/",Socket="http://192.168.31.15:3000/",RoomSrv=Srv+"list",GameSrv=Srv+"listGaming",RegisterSrv=Srv+"register",LoginSrv=Srv+"login",ChangePWSrv=Srv+"changePW",RecordSrv=Srv+"record",isLogin=!1,username="guest",formerPage="Home",token="abc123",gameTypeNo=["1v1","2v2","2v2r","1V1r"],gameTimeNo=["快棋","长考","不限"],Register=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Register.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)
},t.prototype.uiCompHandler=function(){this.addListeners()},t.prototype.addListeners=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.curtain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.curtainHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.userName.addEventListener(egret.FocusEvent.FOCUS_OUT,this.userNameCheck,this),this.password.addEventListener(egret.FocusEvent.FOCUS_OUT,this.passwordCheck,this),this.repeatPW.addEventListener(egret.FocusEvent.FOCUS_OUT,this.repeatPWCheck,this),this.clueName.addEventListener(egret.FocusEvent.FOCUS_OUT,this.clueNameCheck,this)},t.prototype.curtainHandler=function(){this.closePanel()},t.prototype.btnCloseHandler=function(){this.closePanel()},t.prototype.userNameCheck=function(){var e=new RegExp("^[A-Za-z0-9]{4,10}$");return e.test(this.userName.text)?(this.lhintUN.visible=!1,!0):(this.lhintUN.text=" 用户名格式错误 ",this.lhintUN.visible=!0,!1)},t.prototype.passwordCheck=function(){var e=new RegExp("^[!-~]{6,18}$");return e.test(this.password.text)?(this.lhintPW.visible=!1,!0):(this.lhintPW.text=" 密码格式错误 6-18位，英文、数字、符号 ",this.lhintPW.visible=!0,!1)},t.prototype.repeatPWCheck=function(){return this.repeatPW.text!=this.password.text?(this.lhintRP.text=" 请重复密码 ",this.lhintRP.visible=!0,!1):(this.lhintRP.visible=!1,!0)},t.prototype.clueNameCheck=function(){var e=new RegExp("^[一-龥!-~]{1,18}$");return e.test(this.clueName.text)?(this.lhintCN.visible=!1,!0):(this.lhintCN.text=" 不能使用空格或为空 ",this.lhintCN.visible=!0,!1)},t.prototype.btnSubmitHandler=function(){var e=!1,t=this.userNameCheck(),i=this.passwordCheck(),s=this.repeatPWCheck(),n=this.clueNameCheck();if(t&&i&&s&&n&&(e=!0),e){var r={type:"register",username:"",password:"",cluename:""};r.username=this.userName.text,r.password=this.password.text,r.cluename=this.clueName.text,this.httppost(RegisterSrv,r)}},t.prototype.RegisterSuccess=function(e){var t=new LOBBYEVENT(LOBBYEVENT.OPEN);t.pageName="Login",t.username=e,console.log(e+" 注册成功！"),this.dispatchEvent(t),this.closePanel()},t.prototype.RegisterFailed=function(e){e.username&&(this.lhintUN.text=e.username,this.lhintUN.visible=!0),e.password&&(this.lhintPW.text=e.password,this.lhintPW.visible=!0),e.cluename&&(this.lhintCN.text=e.cluename,this.lhintCN.visible=!0),Toast.launch("注册失败 "+e.msg)},t.prototype.httppost=function(e,t){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.POST),i.setRequestHeader("Content-Type","application/json");var s=JSON.stringify(t);i.send(s),i.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),i.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget,i=JSON.parse(t.response);if(i.type)switch(i.type){case"register":this.RegisterSuccess(i.username);break;case"error":this.RegisterFailed(i.error)}},t.prototype.onPostIOError=function(e){Toast.launch("IOError"),console.log("post error : "+e)},t.prototype.onPostProgress=function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},t.prototype.closePanel=function(){this.userName.text="",this.password.text="",this.repeatPW.text="",this.clueName.text="",this.lhintUN.visible=!1,this.lhintPW.visible=!1,this.lhintRP.visible=!1,this.lhintCN.visible=!1,this.parent.removeChild(this)},t}(eui.Component);__reflect(Register.prototype,"Register",["eui.UIComponent","egret.DisplayObject"]);var Room=function(e){function t(){var t=e.call(this)||this;return t.players=[],t.timerAs=[],t.timerBs=[],t.timeA=[],t.timeB=[],t.timer=new egret.Timer(1e3,0),t.currentStepNum=0,t.PxNames=["A","B","C","D","E","F","G","H","I","J","K"],t.PyNames=["0","1","2","3","4","5","6","7","8","9","10"],t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/Room.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.uiCompHandler=function(){this.quit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.quitHandler,this),this.exit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitHandler,this),this.dismiss.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dismissHandler,this),this.kick1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.kick1Handler,this),this.kick2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.kick2Handler,this),this.kick3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.kick3Handler,this),this.kick4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.kick4Handler,this),this.switch12.addEventListener(egret.TouchEvent.TOUCH_TAP,this.switch12Handler,this),this.switch23.addEventListener(egret.TouchEvent.TOUCH_TAP,this.switch23Handler,this),this.switch34.addEventListener(egret.TouchEvent.TOUCH_TAP,this.switch34Handler,this),this.drawoffer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.drawofferHandler,this),this.surrender.addEventListener(egret.TouchEvent.TOUCH_TAP,this.surrenderHandler,this),this.pan.visible=!1,this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.panBack.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnCloseHandler,this),this.btnSubmit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSubmitHandler,this),this.addEventListener(LOBBYEVENT.SOCKETMSG,this.SocketHandler,this),this.start.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startHandler,this),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.prev.addEventListener(egret.TouchEvent.TOUCH_TAP,this.prevHandler,this),this.next.addEventListener(egret.TouchEvent.TOUCH_TAP,this.nextHandler,this),this.beginning.addEventListener(egret.TouchEvent.TOUCH_TAP,this.beginningHandler,this)},t.prototype.prevHandler=function(){if(this.currentStepNum>0){this.currentStepNum--;var e=this.Game.notation.getNotation(this.currentStepNum);this.Game.setupwithNotation(e),this.stepNum.text="#"+this.currentStepNum,this.lastMove.text=this.textMove(e.lastMove)}this.currentStepNum==this.Game.notation.NotationHistory.length-1?this.result.visible=!0:this.result.visible=!1},t.prototype.nextHandler=function(){if(this.currentStepNum<this.Game.notation.NotationHistory.length-1){this.currentStepNum++;var e=this.Game.notation.getNotation(this.currentStepNum);this.Game.setupwithNotation(e),this.stepNum.text="#"+this.currentStepNum,this.lastMove.text=this.textMove(e.lastMove)}this.currentStepNum==this.Game.notation.NotationHistory.length-1?this.result.visible=!0:this.result.visible=!1},t.prototype.beginningHandler=function(){this.currentStepNum=0;var e=this.Game.notation.getNotation(0);this.Game.setupwithNotation(e),this.stepNum.text="#"+this.currentStepNum,this.lastMove.text="",this.currentStepNum==this.Game.notation.NotationHistory.length-1?this.result.visible=!0:this.result.visible=!1},t.prototype.textMove=function(e){if(e.currentPieceName){var t="",i=e.currentPieceName,s="",n="";if(s="move"==e.currentSkill||"kill"==e.currentSkill?"-":"+","move"==e.currentSkill)n=this.PxNames[e.currentTargets[0].Px]+this.PyNames[e.currentTargets[0].Py];else if("Convene"==e.currentSkill||"Summon"==e.currentSkill)for(var r=0;r<e.currentTargets.length;r++)n+="/"+this.PxNames[e.currentTargets[r].Px]+this.PyNames[e.currentTargets[r].Py];else n=e.currentTargets[0].targetPiece+"/"+this.PxNames[e.currentTargets[1].Px]+this.PyNames[e.currentTargets[1].Py];return t=i+s+n}return""},t.prototype.btnCloseHandler=function(){this.pan.visible=!1},t.prototype.startHandler=function(){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.roomID,socket.emit("StartGame",e)},t.prototype.toGaming=function(e){this.Game.gameInfo.players=e.players,this.Game.gameInfo.roomID=e.roomID,this.Game.gameInfo.gameID=e.gameID,this.Game.setupwithNotation(e.notation),this.setBtn(e)},t.prototype.toFinished=function(e){this.setBtn(e),this.currentStepNum=e.notation.NotationHistory.length-1;var t=e.notation;this.Game.SyncNotation(t),this.Game.setupwithNotation(t),this.stepNum.text="#"+this.currentStepNum,this.lastMove.text=this.textMove(t.lastMove),3==e.gameResult.reason?this.reason.text="对方认输":4==e.gameResult.reason?this.reason.text="约和":5==e.gameResult.reason&&(this.reason.text="对方超时")},t.prototype.SocketHandler=function(e){var t=e.roomData;switch(e.socketevent){case"PlayersChanges":1==t.roomState&&this.playerChange(t);break;case"LeaveRoomSuccess":this.BacktoHome();break;case"RoomDismissed":this.BacktoHome(),Toast.launch("房间已解散");break;case"BeKicked":this.BacktoHome();break;case"GameStarted":this.toGaming(t),this.playerChange(t),this.changeCurrentPlayer(t),this.Game.SyncNotation(t.notation),this.Game.setupwithNotation(t.notation);break;case"GameOver":this.toFinished(t);break;case"GotNotation":this.toFinished(t);break;case"NewNotation":this.setPlayerTimer(t),this.changeCurrentPlayer(t),this.Game.setupwithNotation(t.notation),this.Game.SyncNotation(t.notation),this.currentPlayer=t.notation.currentPlayer,this.timer.running||this.timer.start();break;case"OfferingDraw":for(var i=!1,s=0;s<t.drawAccepter.length;s++)username==t.drawAccepter[s]&&(i=!0);this.drawoffer.selected=i;break;case"EnterGameSuccess":this.toGaming(t),this.playerChange(t),this.changeCurrentPlayer(t),this.Game.SyncNotation(t.notation),this.Game.setupwithNotation(t.notation),this.currentPlayer=t.notation.currentPlayer,this.timer.running||this.timer.start()}},t.prototype.quitHandler=function(){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.roomID,socket.emit("LeaveRoom",e)},t.prototype.exitHandler=function(){this.BacktoHome()},t.prototype.dismissHandler=function(){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.roomID,socket.emit("DismissRoom",e)},t.prototype.drawofferHandler=function(){1==this.drawoffer.selected?(this.pan.visible=!0,this.panTitle.text="要提和吗？",this.panContent.text="点击提交键确认提出和棋\n若对方继续行棋表示拒绝",this.submitEvent="DrawOffer",this.drawoffer.selected=!1):(this.pan.visible=!0,this.panTitle.text="要和棋吗？",this.panContent.text="点击提交>>本局和棋\n继续行棋>>拒绝和棋",this.submitEvent="DrawOfferAccept",this.drawoffer.selected=!0)},t.prototype.surrenderHandler=function(){this.pan.visible=!0,this.panTitle.text="要认输吗？",this.submitEvent="Surrender",this.Game.notation.NotationHistory.length<5?this.panContent.text="点击提交-确认认输\n(本局不满4步不记录)":this.panContent.text="点击提交-确认认输"},t.prototype.btnSubmitHandler=function(){var e={username:"",token:"",roomID:"",gameID:""};e.username=username,e.token=token,e.roomID=this.roomID,e.gameID=this.Game.gameInfo.gameID,socket.emit(this.submitEvent,e),this.pan.visible=!1},t.prototype.kick1Handler=function(){var e={username:"",token:"",roomID:"",bekickedPlayer:""};e.username=username,e.token=token,e.roomID=this.roomID,e.bekickedPlayer=this.player1.text,socket.emit("KickPlayer",e)},t.prototype.kick2Handler=function(){var e={username:"",token:"",roomID:"",bekickedPlayer:""};e.username=username,e.token=token,e.roomID=this.roomID,e.bekickedPlayer=this.player2.text,socket.emit("KickPlayer",e)},t.prototype.kick3Handler=function(){var e={username:"",token:"",roomID:"",bekickedPlayer:""};e.username=username,e.token=token,e.roomID=this.roomID,e.bekickedPlayer=this.player3.text,socket.emit("KickPlayer",e)},t.prototype.kick4Handler=function(){var e={username:"",token:"",roomID:"",bekickedPlayer:""};e.username=username,e.token=token,e.roomID=this.roomID,e.bekickedPlayer=this.player4.text,socket.emit("KickPlayer",e)},t.prototype.switch12Handler=function(){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.roomID,socket.emit("Switch12",e)},t.prototype.switch23Handler=function(){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.roomID,socket.emit("Switch23",e)},t.prototype.switch34Handler=function(){var e={username:"",token:"",roomID:""};e.username=username,e.token=token,e.roomID=this.roomID,socket.emit("Switch34",e)},t.prototype.updateroomData=function(e){this.init(e)},t.prototype.init=function(e){this.roomID=e.roomID,this.roomState=e.roomState,this.gameName.text=e.gameName,this.gameType.text=gameTypeNo[e.gameType-1],this.gameTime.text=gameTimeNo[e.gameTime-1],this.gameDate.text=e.gameDate,this.player1.text=e.players[0].playerName,this.player2.text=e.players[1].playerName,this.player3.text=e.players[2].playerName,this.player4.text=e.players[3].playerName,this.setPlayerTimer(e),this.setBtn(e),this.gameStateVS.selectedIndex=e.roomState-1,this.players=[],this.timerAs=[],this.timerBs=[],this.players.push(this.player1),this.players.push(this.player2),this.players.push(this.player3),this.players.push(this.player4),this.timerAs.push(this.timerA1),this.timerAs.push(this.timerA2),this.timerAs.push(this.timerA3),this.timerAs.push(this.timerA4),this.timerBs.push(this.timerB1),this.timerBs.push(this.timerB2),this.timerBs.push(this.timerB3),this.timerBs.push(this.timerB4)},t.prototype.playerChange=function(e){this.player1.text=e.players[0].playerName,this.player2.text=e.players[1].playerName,this.player3.text=e.players[2].playerName,this.player4.text=e.players[3].playerName,this.setPlayerTimer(e),this.setBtn(e)},t.prototype.setBtn=function(e){if(this.gameDate.text=e.gameDate,this.roomState=e.roomState,this.gameStateVS.selectedIndex=this.roomState-1,this.quit.visible=!1,this.exit.visible=!1,this.dismiss.visible=!1,this.surrender.visible=!1,this.start.visible=!1,this.curtain.visible=!1,this.hint.visible=!1,this.drawoffer.visible=!1,1==this.roomState)this.curtain.visible=!0,this.hint.visible=!0,this.gameDate.visible=!0,this.kick1.visible=!1,this.kick2.visible=!1,this.kick3.visible=!1,this.kick4.visible=!1,this.switch12.visible=!1,this.switch23.visible=!1,this.switch34.visible=!1,e.hostName==username&&(this.dismiss.visible=!0,this.start.visible=!0,1==e.gameType?(this.kick1.visible=!0,this.kick2.visible=!0,this.switch12.visible=!0):4==e.gameType?(this.kick1.visible=!0,this.kick2.visible=!0):2==e.gameType?(this.kick1.visible=!0,this.kick2.visible=!0,this.kick3.visible=!0,this.kick4.visible=!0,this.switch12.visible=!0,this.switch23.visible=!0,this.switch34.visible=!0):3==e.gameType&&(this.kick1.visible=!0,this.kick2.visible=!0,this.kick3.visible=!0,this.kick4.visible=!0),(e.players[0].playerName==username||""==e.players[0].playerName)&&(this.kick1.visible=!1),(e.players[1].playerName==username||""==e.players[1].playerName)&&(this.kick2.visible=!1),(e.players[2].playerName==username||""==e.players[2].playerName)&&(this.kick3.visible=!1),(e.players[3].playerName==username||""==e.players[3].playerName)&&(this.kick4.visible=!1));else if(2==this.roomState){var t=!1;e.players[0].playerName==username&&(t=!0),e.players[1].playerName==username&&(t=!0),e.players[2].playerName==username&&(t=!0),e.players[3].playerName==username&&(t=!0),t?(this.surrender.visible=!0,this.drawoffer.visible=!0,this.gameDate.visible=!1):(this.quit.visible=!0,this.gameDate.visible=!0)}else 3==this.roomState?(this.quit.visible=!1,this.exit.visible=!0,this.gameDate.visible=!0,this.T1win.visible=!1,this.T2win.visible=!1,this.Draw.visible=!1,1==e.gameResult.winnerteam?this.T1win.visible=!0:2==e.gameResult.winnerteam?this.T2win.visible=!0:3==e.gameResult.winnerteam&&(this.Draw.visible=!0)):this.exit.visible=!0},t.prototype.setPlayerTimer=function(e){this.timerA1.text=this.S2MMSS(e.players[0].playerTimeA),this.timerB1.text=this.S2MMSS(e.players[0].playerTimeB),this.timerA2.text=this.S2MMSS(e.players[1].playerTimeA),this.timerB2.text=this.S2MMSS(e.players[1].playerTimeB),this.timerA3.text=this.S2MMSS(e.players[2].playerTimeA),this.timerB3.text=this.S2MMSS(e.players[2].playerTimeB),this.timerA4.text=this.S2MMSS(e.players[3].playerTimeA),this.timerB4.text=this.S2MMSS(e.players[3].playerTimeB)},t.prototype.changeCurrentPlayer=function(e){this.timeA=[],this.timeB=[];for(var t=e.notation.currentPlayer-1,i=(e.players[t].playerName,0);i<e.players.length;i++)this.timeA.push(e.players[i].playerTimeA),this.timeB.push(e.players[i].playerTimeB),i==t?this.players[i].textFlow=[{text:this.players[i].text,style:{underline:!0}}]:this.players[i].textFlow=[{text:this.players[i].text,style:{underline:!1}}]},t.prototype.timerFunc=function(){var e=this.currentPlayer-1;this.timeA[e]>0?(this.timeA[e]--,this.timerAs[e].text=this.S2MMSS(this.timeA[e])):this.timeB[e]>0&&(this.timeB[e]--,this.timerBs[e].text=this.S2MMSS(this.timeB[e]));for(var t=0;4>t;t++)this.timeA[t]<=10?this.timerAs[t].textColor=16711680:this.timerAs[t].textColor=13421772,this.timeB[t]<=10?this.timerBs[t].textColor=16711680:this.timerBs[t].textColor=13421772},t.prototype.S2MMSS=function(e){var t,i="00:00";return t=e%60,i=t.toString(),1==i.length&&(i="0"+i),t=(e-t)/60,i=t.toString()+":"+i,4==i.length&&(i="0"+i),i},t.prototype.BacktoHome=function(){var e=new LOBBYEVENT(LOBBYEVENT.OPEN);e.pageName="Home",this.dispatchEvent(e),this.parent.removeChild(this)},t}(eui.Component);__reflect(Room.prototype,"Room",["eui.UIComponent","egret.DisplayObject"]);var socket=io("http://192.168.31.15:3000/");socket.on("ErrorMsg",function(e){Toast.launch(e.msg)});var Target=function(e){function t(t,i,s){var n=e.call(this)||this;n.skinName="resource/custom_skins/Target.exml";var r="";return r=1==t?"destination":"skilltarget",n.targeting.source="resource/pic/game/"+r+".png",n.Px=i,n.Py=s,n.hold=!1,n}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(Target.prototype,"Target",["eui.UIComponent","egret.DisplayObject"]);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,s){function n(e){t.call(s,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(s,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(s,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(s,generateJSON.paths[e])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(s,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(s,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Toast=function(e){function t(t,i,s){var n=e.call(this)||this;return n.skinName="resource/custom_skins/ToastUI.exml",n.toastMsg.text=t,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=i/2,n.y=1*s/3,n.alpha=0,egret.Tween.get(n).to({alpha:1},600,egret.Ease.quintOut).wait(1200).to({alpha:0},1200,egret.Ease.quintIn).call(function(){n.parent&&n.parent.removeChild(n)}),n}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.init=function(e){this._cont=e},t.launch=function(e){if(this._cont){var i=new t(e,this._cont.stage.stageWidth,this._cont.stage.stageHeight);this._cont.addChild(i),this._cont.setChildIndex(i,-1)}},t}(eui.Component);__reflect(Toast.prototype,"Toast",["eui.UIComponent","egret.DisplayObject"]);